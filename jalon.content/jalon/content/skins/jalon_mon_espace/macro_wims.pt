<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="jalon.content">

<body>

<metal:content-core fill-slot="content">
<!-- macro_wims/wims : Page "Mon espace" des exercices WIMS -->
<metal:macro define-macro="wims">

    <tal:condition condition="not:is_ajax">

    <!-- L'attribut data-options permet d'éviter un bug à la fermeture du popup dans certaines conditions non vraiment définies… -->
    <div id="reveal-main" class="reveal-modal medium" data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>
    <div id="reveal-main_xlarge" class="reveal-modal xlarge" data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>

    <main class="row" role="main" aria-labelledby="page_title">

        <metal:macro use-macro="here/macro_global_statusmessage/macros/portal_message">Message de session</metal:macro>

        <metal:macro use-macro="context/macro_messages/macros/messages">
            Macro d'affichage des messages de feedback
        </metal:macro>

        <section class="show-for-medium-up medium-12 columns">

            <div id="item-adder">
                <a class="button expand create" data-reveal-id="reveal-main" data-reveal-ajax="true"
                   tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_creer_mon_espace&amp;formulaire=ajout-wims">
                   <i class="fa fa-plus-circle"></i>
                   <tal:block i18n:translate="">Créer un exercice Wims</tal:block>
                </a>
            </div>

        </section>

        <section class="small-12 columns">

            <h2 class="texte_icone icone_tags" i18n:translate="">Étiquettes</h2>
            <ul id="js-tag_filter">
                <metal:macro use-macro="context/tag_macro/macros/create-tag">
                    Bouton de création des étiquettes
                </metal:macro>
                <metal:macro use-macro="context/tag_macro/macros/tag">
                    Affichage de la liste des étiquettes
                </metal:macro>
            </ul>

        </section>

        <section id="js-list-ressource" class="small-12 columns ressource-wims">
            <h2 id="js-update_title"><i class="fa fa-random"></i><tal:block i18n:translate="">Exercices</tal:block></h2>

            <div id="js-update_target"
                 tal:attributes="data-href string:${context/absolute_url}">
                <metal:macro use-macro="context/macro_wims_liste/macros/wims_liste">
                    Macro d'affichage de la liste des exercices
                </metal:macro>
            </div>

        </section>

    </main>

    <tal:block define="script string:setTagFilter()">
        <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
    </tal:block>

    </tal:condition>

    <tal:condition condition="is_ajax">

        <metal:macro use-macro="context/macro_wims_liste/macros/wims_liste">
            Macro d'affichage de la liste des exercices
        </metal:macro>

    </tal:condition>

</metal:macro>


<!--lister_modules_wims : Lister les modules wims publiés sous "module_path"
	en entrée :
		module_path : chemin de depart du listing (ou chemin du module)
		param_wims :
-->
<metal:macro define-macro="lister_modules">
	<div id="wims_list_modules" class="arrondi"
		 tal:define="authMember user/getId;
		  			 liste_modules python:context.lister_modules_wims(authMember, module_path);">
		<h3>Parcourez la liste :</h3>
		<ul tal:condition="module_path">
            <li class="cat_wims">
                <a class="load_in_page arrondi" style="display:block"
  			  	   tal:attributes="href string:${context/id}/${template/id}"
  			  	   i18n_translate="">
                    &larr; Revenir au choix du niveau
                </a>
            </li>
        </ul>
		<ul tal:condition="python:liste_modules['status']=='OK'">
			<li class="cat_wims" tal:repeat="module liste_modules/listContent">
                <a class="load_in_page arrondi" style="display:block"
                   tal:attributes="href string:${context/id}/${template/id}?module_path=${module/module_path}">
                    <span tal:content="python:test(module['title']!='',module['title'],module['id'])"/>
                </a>
            </li>
		</ul>
		<div class="listing_vide"
             tal:define="test liste_modules/listContent | string:test"
             tal:condition="not:test">
            Aucun élément
        </div>
		<div id="infos_module"
             tal:condition="python:liste_modules['status']=='ERROR'">
			<div tal:define="infos_module python:context.getModule(authMember, module_path);">
                <h3 tal:content="infos_module/title"/>
			  	Description : <span tal:content="infos_module/description"/><br />
			  	Langue : <span tal:content="infos_module/language"/><br />
			  	Auteur : <a tal:attributes="href string:mailto:${infos_module/author_address}">
                            <span tal:content="infos_module/author"/>
                        </a><br />
				<iframe class="arrondi couleur4" width="100%" height="700"
						tal:define="lang string:fr"
						tal:attributes="src string:${infos_module/index_url}&amp;session=${param_wims/wims_session}&amp;lang=${lang}">
				</iframe>
            </div>
		</div>
	</div>
</metal:macro>

<!--purger_activites : Purge toutes les activités d'un cours, et affiche le résultat ; context : un cours -->
<metal:macro define-macro="purger_activites">

    <div>
        <a href="../" class="bouton small blanc" i18n:translate="">&larr; Retour</a>
    </div>
    <div class="arrondi spacer">
        <h3>
            <span i18n:translate="">Résultat de la purge du cours </span>
            <strong tal:content="context/Title"/> :
        </h3>
        <div tal:define="resultat python:context.purgerActivitesWims()">
            <tal:block condition="resultat">
            <div  id="message" >
                <div class="success" i18n:translate="">
                    Nettoyage effectué
                </div>
            </div>
            <ul>
                <li tal:repeat="user python:resultat.keys()">
                    Activités créées par <strong tal:content="user"/> :
                    <span tal:content="python:resultat[user]['cleaned']"/> activités d'étudiants supprimées.
                </li>
            </ul>
            </tal:block>
            <div tal:condition="not:resultat" id="message" >
                <div class="success" i18n:translate="">
                    Aucune activité WIMS a nettoyer dans ce cours.
                </div>
            </div>
        </div>
    </div>
</metal:macro>


<!--
        Supprimer un exercice / un groupe
-->
<metal:macro define-macro="supprimer_exo">

  <tal:condition condition="python:context.test(len(context.getRawRelatedItems()) == 0, 1, 0)">
    <metal:macro use-macro="here/macro_form/macros/supprimer">Supression autorisée</metal:macro>
  </tal:condition>

  <tal:condition condition="python:context.test(len(context.getRawRelatedItems()) != 0, 1, 0)">
    <h2 class="warning">
        <i class="fa fa-exclamation-triangle no-pad"></i>
        <tal:block i18n:translate="">Suppression non autorisée</tal:block>
        <a class="close-reveal-modal" aria-label="Close"></a>
    </h2>

    <div class="panel warning radius">
        <p>
            <i class="fa fa-info-circle no-pad"></i>
            <tal:block i18n:translate="">
                <tal:exercice condition="python: context.modele != 'groupe'">L'exercice</tal:exercice>
                <tal:groupe   condition="python: context.modele == 'groupe'">Le groupe</tal:groupe>
                "<strong tal:content="context/Title"/>"
                ne peut être supprimé, car il est associé aux éléments suivants :
            </tal:block>
        </p>
        <ul tal:repeat="elem context/getRelatedItems" style="list-style-type:initial;">
            <li style="display:list-item !important;"
                tal:define="elem_type elem/getTypeWims| nothing">
                <a tal:attributes="href elem/absolute_url"><tal:block tal:content="elem/Title"/>
                    <tal:block condition="elem_type" content="string:(${elem_type})"/>
                </a>
            </li>
        </ul>
    </div>

    <div class="text-center">
        <a class="button small radius close-custom-modal">
            D'accord, j'ai compris.
        </a>
    </div>
    <script>
        $('a.close-custom-modal').on('click', function() {
          $('#reveal-main').foundation('reveal','close');
        });
    </script>
  </tal:condition>
</metal:macro>

</metal:content-core>

</body>
</html>

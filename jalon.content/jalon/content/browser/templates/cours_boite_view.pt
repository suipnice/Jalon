<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="jalon.content">

<body>

<metal:core fill-slot="main"
            tal:define="anonymous python:user.has_role('Anonymous');
                        subject request/subject | nothing;
                        mode_etudiant request/mode_etudiant | string:false;
                        menu request/menu | string:depots;
                        isDepotActif context/isDepotActif">

    <metal:macro use-macro="context/macro_navigation/macros/fil_d_ariane">
        Page d'affichage du fil d'ariane
    </metal:macro>

    <main class="row" role="main" aria-labelledby="page_title">

        <metal:macro use-macro="here/macro_global_statusmessage/macros/portal_message">
            Message de session
        </metal:macro>

        <div class="row"
             tal:define="message request/message | nothing"
             tal:condition="message">
            <metal:macro use-macro="context/macro_messages/macros/messages">
                encart d'affichage des messages de feedback
            </metal:macro>
        </div>

        <tal:condition condition="anonymous">
        <div class="small-12 columns text-center">
            <div class="panel radius warning text-center">
                <i class="fa fa-warning"></i>
                <strong i18n:translate="">Désolé, seul un utilisateur connecté peux participer aux activités d'un cours.</strong>
            </div>
            <a tal:define="page_quote python:context.jalon_quote(here/absolute_url)"
               tal:attributes="href string:${here/absolute_url}/login_form?came_from=${page_quote}"
               class="showmore button">
               <i class="fa fa-key"></i>
               <tal:block i18n:translate="">Se connecter</tal:block>
            </a>
        </div>
        </tal:condition>

        <tal:condition condition="not:anonymous">
        <div id="reveal-main" 
             class="reveal-modal medium" data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>
        <div id="reveal-main-small" 
             class="reveal-modal small" data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>

        <tal:define define="affElement python:context.isAfficherElement(context.getDateAff(), context.getDateMasq());
                            personnel python:context.isPersonnel(user,mode_etudiant);">

            <tal:condition condition="python:context.test((not personnel) and affElement['val'] == 0, 1, 0)">
            <section id="boite" class="medium-8 small-12 columns">
                <h1>
                    <i class="fa fa-inbox no-pad"></i>
                    <tal:replace replace="here/Title" />
                </h1>
                <div class="panel alert radius">
                    <strong i18n:translate="">Attention :</strong> <tal:block i18n:translate="">cette boîte de dépôts est masquée, vous n'avez pas le droit d'y accéder.</tal:block>
                </div>
            </section>
            <section id="boite_informations" class="medium-4 small-12 columns">
                <tal:condition condition="python:context.test(context.isAuteurs(user.getId()), 1, 0)">
                    <metal:macro use-macro="context/macro_cours_life/macros/mode_affichage">
                        Mode Enseignant / Etudiant
                    </metal:macro>
                </tal:condition>
            </section>
            </tal:condition>

            <tal:condition condition="python:context.test(personnel or affElement['val'] != 0, 1, 0)">
            <section id="boite" class="medium-8 small-12 columns"
                     tal:define="nbDepots python:context.getNbDepots(personnel);
                                 nbSujets context/getNbSujets;
                                 afficher_comp context/getAfficherCompetences;
                                 nbCompetences context/getNbCompetences">
                <tal:condition condition="personnel">
                <a class="button small radius dropdown right" data-options="align:bottom" data-dropdown="boite-options">
                    <i class="fa fa-cogs"></i><tal:block i18n:translate="">Options</tal:block>
                </a>
                <ul id="boite-options" data-dropdown-content class="f-dropdown">
                    <li>
                        <a tal:condition="not:affElement/val"
                           tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_cours_afficher&amp;formulaire=afficher-element&amp;idElement=${context/getId};"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                            <i class="fa fa-eye fa-fw"></i> <tal:block i18n:translate="">Afficher</tal:block>
                        </a>
                        <a tal:condition="affElement/val"
                           tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_cours_afficher&amp;formulaire=masquer-element&amp;idElement=${context/getId};"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                            <i class="fa fa-eye-slash fa-fw"></i> <tal:block i18n:translate="">Masquer</tal:block>
                        </a>
                    </li>
                    <li>
                        <a tal:attributes="href string:${context/absolute_url}/${context/getId}/folder_form?macro=macro_cours_boite&amp;formulaire=modifier-boite-info&amp;menu=${menu}"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                           <i class="fa fa-align-justify"></i> <tal:block i18n:translate="">Titre et consigne</tal:block>
                        </a>
                    </li>
                </ul>
                </tal:condition>
                <h1>
                    <i class="fa fa-inbox no-pad"></i>
                    <tal:replace replace="here/Title" />
                </h1>
                <ul id="tab_button-group" class="button-group radius">
                    <li>
                        <a tal:attributes="class python:context.test(menu == 'depots', 'button small selected', 'button small');
                                           href string:${context/absolute_url}?menu=depots&amp;mode_etudiant=${mode_etudiant}"
                           i18n:translate="">
                            <i class="fa fa-download"></i>
                            <tal:condition condition="python:context.test(not personnel and not context.getAccesDepots(), 1, 0)"
                                           i18n:translate="">Mes dépôts</tal:condition>
                            <tal:condition condition="python:context.test(personnel or context.getAccesDepots(), 1, 0)"
                                       i18n:translate="">Dépôts étudiants</tal:condition>
                            <span class="sup" tal:content="nbDepots"/>
                        </a>
                    </li>
                    <li>
                        <a tal:attributes="class python:context.test(menu == 'sujets', 'button small selected', 'button small');
                                           href string:${context/absolute_url}?menu=sujets&amp;mode_etudiant=${mode_etudiant}"
                           i18n:translate="">
                            <i class="fa fa-upload"></i>
                            <tal:block i18n:translate="">Documents enseignants</tal:block>
                            <span class="sup" tal:content="nbSujets"/>
                        </a>
                    </li>
                    <li tal:condition="python:personnel or afficher_comp">
                        <a tal:attributes="class python:context.test(menu == 'competences', 'button small selected', 'button small');
                                           href string:${context/absolute_url}?menu=competences&amp;mode_etudiant=${mode_etudiant}"
                           i18n:translate="">
                            <i class="fa fa-tasks"></i>
                            <tal:block i18n:translate="">Compétences</tal:block>
                            <span class="sup" tal:content="nbCompetences"/>
                        </a>
                    </li>
                </ul>

                <tal:block condition="python:menu == 'sujets'">
                    <metal:macro use-macro="context/macro_cours_activites/macros/liste-sujets">
                        Page d affichage de la liste des sujets
                    </metal:macro>
                </tal:block>
                <tal:block condition="python:menu != 'sujets'">
                    <metal:macro use-macro="python:context.macro_cours_boite.macros.get(menu)">
                        Page d affichage de la liste des dépôts ou des compétences
                    </metal:macro>
                </tal:block>

            </section>

            <aside class="medium-4 small-12 columns">
                <tal:condition condition="python:context.test(context.isAuteurs(user.getId()), 1, 0)">
                <metal:macro use-macro="context/macro_cours_life/macros/mode_affichage">
                    Mode Enseignant / Etudiant
                </metal:macro>
                </tal:condition>
                <h2>
                    <a class="button tiny radius dropdown right"
                       data-options="align:bottom" data-dropdown="instruction-options"
                       tal:condition="personnel">
                        <i class="fa fa-pencil"></i>
                        <tal:block i18n:translate="">Modifier</tal:block>
                    </a>
                    <i class="fa fa-info"></i><tal:block i18n:translate="">Instructions</tal:block>
                </h2>
                <ul id="instruction-options" data-dropdown-content class="f-dropdown"
                    tal:condition="personnel">
                    <li>
                        <a tal:attributes="href string:${context/absolute_url}/${context/getId}/folder_form?macro=macro_cours_boite&amp;formulaire=modifier-boite-date&amp;menu=${menu}"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                            <i class="fa fa-calendar fa-fw"></i>
                            <tal:block i18n:translate="">Date</tal:block>
                        </a>
                    </li>
                    <li>
                        <a tal:attributes="href string:${context/absolute_url}/${context/getId}/folder_form?macro=macro_cours_boite&amp;formulaire=modifier-boite-info&amp;menu=${menu}"
                           data-reveal-id="reveal-main" data-reveal-ajax="true">
                            <i class="fa fa-align-justify"></i>
                            <tal:block  i18n:translate="">Titre et consigne</tal:block>
                        </a>
                    </li>
                </ul>
                <div class="panel bkgrnd radius">
                    <h3>
                        <i class="fa fa-clock-o fa-fw no-pad"></i>
                        <tal:block i18n:translate="">Date limite</tal:block>
                    </h3>
                    <div tal:attributes="class python:context.test(isDepotActif == 2, 'panel warning radius', 'panel callout radius')">
                        <tal:block content="python:context.getAffDate('DateDepot')"/>
                        <div tal:condition="python:isDepotActif == 2">
                            <i class="fa fa-warning no-pad"></i>
                            <tal:block i18n:translate="">Dernières minutes !</tal:block>
                        </div>
                    </div>
                    <h3>
                        <i class="fa fa-hand-paper-o fa-fw no-pad"></i>
                        <tal:block i18n:translate="">Consigne</tal:block>
                    </h3>
                    <div class="panel callout radius">
                        <tal:replace replace="structure context/Description"
                                     condition="context/Description"/>
                        <tal:replace replace="structure string:Aucune consigne."
                                     condition="not:context/Description"
                                     i18n:translate=""/>
                    </div>
                </div>

                <tal:condition condition="python:context.test(menu == 'depots', 1, 0)">
                <a class="button radius tiny right"
                    tal:attributes="href string:${context/absolute_url}/${context/getId}/folder_form?macro=macro_cours_boite&amp;formulaire=modifier-boite-avancees&amp;menu=${menu}"
                    data-reveal-id="reveal-main" data-reveal-ajax="true"
                    tal:condition="personnel">
                    <i class="fa fa-pencil"></i>
                    <tal:block  i18n:translate="">Modifier</tal:block>
                </a>
                <h2>
                    <i class="fa fa-cogs"></i><tal:block i18n:translate="">Options des dépôts</tal:block>
                </h2>
                <div class="panel bkgrnd radius options_boite-depot">
                    <ul tal:define="option context/getOptionsAvancees">
                        <li tal:define="correction option/getCorrectionIndividuelle">
                            <i tal:attributes="class python:context.test(correction['actif'], 'fa fa-toggle-on success', 'fa fa-toggle-off')"></i>
                            Correction des dépôts
                        </li>
                        <li tal:define="notification option/getNotificationCorrection">
                            <i tal:attributes="class python:context.test(notification['actif'], 'fa fa-toggle-on success', 'fa fa-toggle-off')"></i>
                            Notification des corrections
                        </li>
                        <li tal:define="notation option/getNotation">
                            <i tal:attributes="class python:context.test(notation['actif'], 'fa fa-toggle-on success', 'fa fa-toggle-off')"></i>
                            Notation des dépôts
                        </li>
                        <li tal:define="notification option/getNotificationNotation">
                            <i tal:attributes="class python:context.test(notification['actif'], 'fa fa-toggle-on success', 'fa fa-toggle-off')"></i>
                            Notification des notations
                        </li>
                        <li tal:define="acces_depots option/getAccesDepots">
                            <i tal:attributes="class python:context.test(acces_depots['actif'], 'fa fa-toggle-on success', 'fa fa-toggle-off')"></i>
                            Visualisation des dépôts entre étudiants
                        </li>
                    </ul>
                </div>
                </tal:condition>

                <tal:condition condition="python:context.test(menu == 'competences', 1, 0)">
                <a class="button radius tiny right"
                    tal:attributes="href string:${context/absolute_url}/folder_form?macro=macro_cours_boite&amp;formulaire=permission-competence"
                    data-reveal-id="reveal-main" data-reveal-ajax="true"
                    tal:condition="personnel">
                    <i class="fa fa-pencil"></i>
                    <tal:block  i18n:translate="">Modifier</tal:block>
                </a>
                <h2>
                    <i class="fa fa-cogs"></i><tal:block i18n:translate="">Options des compétences</tal:block>
                </h2>
                <div class="panel bkgrnd radius">
                    <ul class="options_boite">
                        <li tal:define="afficher context/getAfficherCompetences"
                            tal:attributes="style python:context.test(afficher, 'color:green', 'color:red')">
                            <i tal:attributes="class python:context.test(afficher, 'fa fa-check', 'fa fa-times')"></i>
                            Affichage de l'onglet "Compétences" aux étudiants
                        </li>
                        <li tal:define="modifier context/getModifierCompetences;
                                        isModifierComp python:context.getPermissionModifierCompetence(personnel, user.getId())"
                            tal:attributes="style python:context.test(modifier, 'color:green', 'color:red')"
                            tal:condition="isModifierComp">
                            <i tal:attributes="class python:context.test(modifier, 'fa fa-check', 'fa fa-times')"></i>
                            Restriction de la gestion des compétences
                        </li>
                    </ul>
                </div>
                </tal:condition>
            </aside>
            </tal:condition>
        </tal:define>
        </tal:condition>
    </main>

</metal:core>

</body>

</html>
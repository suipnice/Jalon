!function($){var e={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(e){return"<li>"+e[this.propertyToSearch]+"</li>"},tokenFormatter:function(e){return"<li><p>"+e[this.propertyToSearch]+"</p></li>"},onResult:null,onAdd:null,onDelete:null,onReady:null},t={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"},n={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},i={init:function(t,n){var o=$.extend({},e,n||{});return this.each(function(){$(this).data("tokenInputObject",new $.TokenList(this,t,o))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(e){return this.data("tokenInputObject").add(e),this},remove:function(e){return this.data("tokenInputObject").remove(e),this},get:function(){return this.data("tokenInputObject").getTokens()}};$.fn.tokenInput=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):i.init.apply(this,arguments)},$.TokenList=function(e,i,a){function s(){return null!==a.tokenLimit&&F>=a.tokenLimit?(I.hide(),void g()):void 0}function l(){if(S!==(S=I.val())){var e=S.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");W.html(e),I.width(W.width()+30)}}function r(e){return e>=48&&90>=e||e>=96&&111>=e||e>=186&&192>=e||e>=219&&222>=e}function c(e){var t=a.tokenFormatter(e);t=$(t).addClass(a.classes.token).insertBefore(M),$("<span>"+a.deleteText+"</span>").addClass(a.classes.tokenDelete).appendTo(t).click(function(){return f($(this).parent()),N.change(),!1});var n={id:e.id};return n[a.propertyToSearch]=e[a.propertyToSearch],$.data(t.get(0),"tokeninput",e),P=P.slice(0,B).concat([n]).concat(P.slice(B)),B++,k(P,N),F+=1,null!==a.tokenLimit&&F>=a.tokenLimit&&(I.hide(),g()),t}function u(e){var t=a.onAdd;if(F>0&&a.preventDuplicates){var n=null;if(G.children().each(function(){var t=$(this),o=$.data(t.get(0),"tokeninput");return o&&o.id===e.id?(n=t,!1):void 0}),n)return d(n),M.insertAfter(n),void I.focus()}(null==a.tokenLimit||F<a.tokenLimit)&&(c(e),s()),I.val(""),g(),$.isFunction(t)&&t.call(N,e)}function d(e){e.addClass(a.classes.selectedToken),j=e.get(0),I.val(""),g()}function p(e,t){e.removeClass(a.classes.selectedToken),j=null,t===n.BEFORE?(M.insertBefore(e),B--):t===n.AFTER?(M.insertAfter(e),B++):(M.appendTo(G),B=F),I.focus()}function h(e){var t=j;j&&p($(j),n.END),t===e.get(0)?p(e,n.END):d(e)}function f(e){var t=$.data(e.get(0),"tokeninput"),n=a.onDelete,o=e.prevAll().length;o>B&&o--,e.remove(),j=null,I.focus(),P=P.slice(0,o).concat(P.slice(o+1)),B>o&&B--,k(P,N),F-=1,null!==a.tokenLimit&&I.show().val("").focus(),$.isFunction(n)&&n.call(N,t)}function k(e,t){var n=$.map(e,function(e){return e[a.tokenValue]});t.val(n.join(a.tokenDelimiter))}function g(){U.hide().empty(),_=null}function m(){U.css({position:"absolute",top:$(G).offset().top+$(G).outerHeight(),left:$(G).offset().left,zindex:999}).show()}function v(){a.searchingText&&(U.html("<p>"+a.searchingText+"</p>"),m())}function T(){a.hintText&&(U.html("<p>"+a.hintText+"</p>"),m())}function y(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function C(e,t,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","g"),y(t,n))}function E(e,t){if(t&&t.length){U.empty();var n=$("<ul>").appendTo(U).mouseover(function(e){w($(e.target).closest("li"))}).mousedown(function(e){return u($(e.target).closest("li").data("tokeninput")),N.change(),!1}).hide();$.each(t,function(t,o){var i=a.resultsFormatter(o);i=C(i,o[a.propertyToSearch],e),i=$(i).appendTo(n),i.addClass(t%2?a.classes.dropdownItem:a.classes.dropdownItem2),0===t&&w(i),$.data(i.get(0),"tokeninput",o)}),m(),a.animateDropdown?n.slideDown("fast"):n.show()}else a.noResultsText&&(U.html("<p>"+a.noResultsText+"</p>"),m())}function w(e){e&&(_&&D($(_)),e.addClass(a.classes.selectedDropdownItem),_=e.get(0))}function D(e){e.removeClass(a.classes.selectedDropdownItem),_=null}function R(){var e=I.val().toLowerCase();e&&e.length&&(j&&p($(j),n.AFTER),e.length>=a.minChars?(v(),clearTimeout(O),O=setTimeout(function(){x(e)},a.searchDelay)):g())}function x(e){var t=e+A(),n=b.get(t);if(n)E(e,n);else if(a.url){var o=A(),i={};if(i.data={},o.indexOf("?")>-1){var s=o.split("?");i.url=s[0];var l=s[1].split("&");$.each(l,function(e,t){var n=t.split("=");i.data[n[0]]=n[1]})}else i.url=o;i.data[a.queryParam]=e,i.type=a.method,i.dataType=a.contentType,a.crossDomain&&(i.dataType="jsonp"),i.success=function(n){$.isFunction(a.onResult)&&(n=a.onResult.call(N,n)),b.add(t,a.jsonContainer?n[a.jsonContainer]:n),I.val().toLowerCase()===e&&E(e,a.jsonContainer?n[a.jsonContainer]:n)},$.ajax(i)}else if(a.local_data){var r=$.grep(a.local_data,function(t){return t[a.propertyToSearch].toLowerCase().indexOf(e.toLowerCase())>-1});$.isFunction(a.onResult)&&(r=a.onResult.call(N,r)),b.add(t,r),E(e,r)}}function A(){var e=a.url;return"function"==typeof a.url&&(e=a.url.call()),e}if("string"===$.type(i)||"function"===$.type(i)){a.url=i;var L=A();void 0===a.crossDomain&&(a.crossDomain=-1===L.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==L.split(/\/+/g)[1])}else"object"==typeof i&&(a.local_data=i);a.classes?a.classes=$.extend({},t,a.classes):a.theme?(a.classes={},$.each(t,function(e,t){a.classes[e]=t+"-"+a.theme})):a.classes=t;var P=[],F=0,b=new $.TokenList.Cache,O,S,I=$('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",a.idPrefix+e.id).focus(function(){(null===a.tokenLimit||a.tokenLimit!==F)&&T()}).blur(function(){g(),$(this).val("")}).bind("keyup keydown blur update",l).keydown(function(e){var t,i;switch(e.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if($(this).val()){var a=null;return a=e.keyCode===o.DOWN||e.keyCode===o.RIGHT?$(_).next():$(_).prev(),a.length&&w(a),!1}t=M.prev(),i=M.next(),t.length&&t.get(0)===j||i.length&&i.get(0)===j?e.keyCode===o.LEFT||e.keyCode===o.UP?p($(j),n.BEFORE):p($(j),n.AFTER):e.keyCode!==o.LEFT&&e.keyCode!==o.UP||!t.length?e.keyCode!==o.RIGHT&&e.keyCode!==o.DOWN||!i.length||d($(i.get(0))):d($(t.get(0)));break;case o.BACKSPACE:if(t=M.prev(),!$(this).val().length)return j?(f($(j)),N.change()):t.length&&d($(t.get(0))),!1;1===$(this).val().length?g():setTimeout(function(){R()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:if(_)return u($(_).data("tokeninput")),N.change(),!1;break;case o.ESCAPE:return g(),!0;default:String.fromCharCode(e.which)&&setTimeout(function(){R()},5)}}),N=$(e).hide().val("").focus(function(){I.focus()}).blur(function(){I.blur()}),j=null,B=0,_=null,G=$("<ul />").addClass(a.classes.tokenList).click(function(e){var t=$(e.target).closest("li");t&&t.get(0)&&$.data(t.get(0),"tokeninput")?h(t):(j&&p($(j),n.END),I.focus())}).mouseover(function(e){var t=$(e.target).closest("li");t&&j!==this&&t.addClass(a.classes.highlightedToken)}).mouseout(function(e){var t=$(e.target).closest("li");t&&j!==this&&t.removeClass(a.classes.highlightedToken)}).insertBefore(N),M=$("<li />").addClass(a.classes.inputToken).appendTo(G).append(I),U=$("<div>").addClass(a.classes.dropdown).appendTo("body").hide(),W=$("<tester/>").insertAfter(I).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:I.css("fontSize"),fontFamily:I.css("fontFamily"),fontWeight:I.css("fontWeight"),letterSpacing:I.css("letterSpacing"),whiteSpace:"nowrap"});N.val("");var H=a.prePopulate||N.data("pre");a.processPrePopulate&&$.isFunction(a.onResult)&&(H=a.onResult.call(N,H)),H&&H.length&&$.each(H,function(e,t){c(t),s()}),$.isFunction(a.onReady)&&a.onReady.call(),this.clear=function(){G.children("li").each(function(){0===$(this).children("input").length&&f($(this))})},this.add=function(e){u(e)},this.remove=function(e){G.children("li").each(function(){if(0===$(this).children("input").length){var t=$(this).data("tokeninput"),n=!0;for(var o in e)if(e[o]!==t[o]){n=!1;break}n&&f($(this))}})},this.getTokens=function(){return P}},$.TokenList.Cache=function(e){var t=$.extend({max_size:500},e),n={},o=0,i=function(){n={},o=0};this.add=function(e,a){o>t.max_size&&i(),n[e]||(o+=1),n[e]=a},this.get=function(e){return n[e]}}}(jQuery);
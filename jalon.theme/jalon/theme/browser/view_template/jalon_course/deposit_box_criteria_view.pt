<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="jalon.content">

<body>

<metal:main fill-slot="content"
            tal:define="criteria_id request/criteria_id | string:0;
                        mode_etudiant request/mode_etudiant | nothing;
                        my_view python:view.getCriteriaView(user, mode_etudiant);
                        mode_etudiant my_view/mode_etudiant">

    <tal:define define="breadcrumbs view/getBreadcrumbs">
    <metal:macro use-macro="context/breadcrumbs_macro/macros/breadcrumbs">
        Page d'affichage du fil d'ariane
    </metal:macro>
    </tal:define>

    <div id="reveal-main" class="reveal-modal medium" 
         data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>
    <div id="reveal-main_second" class="reveal-modal medium"
         data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>
    <div id="reveal-main-large" class="reveal-modal large"
         data-reveal="data-reveal" data-options="close_on_background_click: true;"></div>

    <main class="row" role="main" aria-labelledby="page_title">
        <h1>
            <i class="fa fa-th falfw"></i>Grille d'évaluation
        </h1>

        <tal:condition condition="my_view/is_personnel">
        <div id="item-adder"
             tal:condition="my_view/is_depot_actif">
            <a class="button expand create" data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${context/absolute_url}/add_deposit_box_criteria_form">
               <i class="fa fa-plus-circle"></i>
               <tal:block i18n:translate="">Ajouter un critère d'évaluation</tal:block>
            </a>
        </div>

        <div class="panel radius warning"
             tal:condition="not:my_view/is_authorized_deposit">
            <i class="fa fa-info-circle fa-fw"></i><strong>Attention :</strong> Dans le profil évaluation par les pairs les "dates limite de dépôts et d'évaluation" sont obligatoires.
        </div>
        <tal:condition condition="my_view/is_authorized_deposit">
        <div class="panel radius warning"
             tal:condition="not:my_view/is_depot_actif">
            <i class="fa fa-info-circle fa-fw"></i><strong>Attention :</strong> La date limite de dépôt est dépassée vous ne pouvez plus modifier la grille d'évaluation.
        </div>
        <div class="panel radius warning"
             tal:condition="not:my_view/is_correction_actif">
            <i class="fa fa-info-circle fa-fw"></i><strong>Attention :</strong> La date limite d'évaluation est dépassée, vous pouvez annuler un critère d'évaluation.
        </div>
        </tal:condition>
        </tal:condition>

        <div class="panel callout radius"
             tal:condition="not:my_view/criteria_order">
            La grille d'évaluation ne contient aucun critère d'évaluation
        </div>

        <ul class="tabs" data-tab role="tablist">
            <tal:repeat repeat="index my_view/criteria_order">
            <li role="presentation"
                tal:attributes="class python:context.test(index == criteria_id, 'tab-title active', 'tab-title')">
                <a role="tab" tabindex="0" aria-selected="true"
                   tal:attributes="href string:#criteria${repeat/index/number};
                                   aria-controls string:#criteria${repeat/index/number}"
                   tal:content="string:Critère ${repeat/index/number}"/>
            </li>
            </tal:repeat>
        </ul>

        <div class="tabs-content peer_evaluate"
             tal:condition="my_view/criteria_order">
            <section role="tabpanel" aria-hidden="true" 
                     tal:attributes="class python:context.test(criteria_id == '0', 'content active', 'content')">
                <div class="panel callout radius">Sélectionnez un onglet</div>
            </section>

            <tal:repeat repeat="index my_view/criteria_order">
            <section role="tabpanel" aria-hidden="true"
                     tal:define="criteria python:my_view['criteria_dict'][index];
                                 criteria_ccs_id string:criteria${repeat/index/number};"
                     tal:attributes="id criteria_ccs_id;
                                     class python:context.test(index == criteria_id, 'content active', 'content')">
                <h2>
                    <tal:condition condition="my_view/is_personnel">
                    <tal:condition condition="my_view/is_depot_actif">
                    <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:attributes="href string:${my_view/deposit_box_link}/delete_deposit_box_criteria_form?criteria_id=${index}">
                        <i class="fa fa-trash-o alert"></i>
                    </a>
                    <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:attributes="href string:${my_view/deposit_box_link}/edit_deposit_box_criteria_form?criteria_id=${index}">
                        <i class="fa fa-pencil"></i>
                    </a>
                    </tal:condition>
                    <tal:condition condition="not:my_view/is_correction_actif">
                    <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:attributes="href string:${my_view/deposit_box_link}/undo_deposit_box_criteria_form?criteria_id=${index}">
                        <i class="fa fa-undo warning"></i>
                    </a>
                    <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:attributes="href string:${my_view/deposit_box_link}/redo_deposit_box_criteria_form?criteria_id=${index}">
                        <i class="fa fa-pencil"></i>
                    </a>
                    </tal:condition>
                    </tal:condition>
                    <tal:replace replace="criteria/title"/> 
                </h2>
                <h3>Description :</h3>
                <div class="panel callout radius"
                     tal:content="criteria/description"/>
                <h3>
                    Coefficient : <tal:replace replace="criteria/coefficient"/>
                </h3>
                <h3>
                    Marge : <tal:replace replace="criteria/gap"/>
                </h3>
                <h3>
                    Commentaire étudiant : <tal:replace replace="python:my_view['comment_dict'][criteria['comment']]"/>
                </h3>
                <h3>
                    Taille du commentaire : entre <tal:replace replace="criteria/comment_min"/> et <tal:replace replace="criteria/comment_max"/> caractères
                </h3>
            </section>
            </tal:repeat>
        </div>
    </main>
</metal:main>

</body>

</html>
<metal:macro define-macro="add_course_items">

    <tal:no_items condition="my_view/is_no_items">
        <div class="panel callout radius">
            <strong i18n:translate="">Il n'y a aucune ressource de type « Fichier » dans votre espace.</strong><br />
            <tal:block i18n:translate="">Rendez-vous dans votre espace de fichiers pour en ajouter.</tal:block>
        </div>
        <div class="text-center">
            <a class="button radius"
               tal:attributes="href my_view/folder_link">
               <i tal:attributes="class my_view/course_add_list_icon"></i><tal:replace replace="context/Title" i18n:translate=""/>
            </a>
        </div>
    </tal:no_items>

    <tal:block condition="not:my_view/is_no_items">
        <div class="panel callout radius"
             tal:condition="not:my_view/course_add_list"
             i18n:translate="">
            Il n'y a aucune ressource avec cette association d'étiquettes.
        </div>
    </tal:block>

    <tal:listing condition="my_view/course_add_list">
    <div class="el_counter">
        <tal:block replace="my_view/nb_display_items" />
        <tal:block i18n:translate="">sur</tal:block>
        <tal:block replace="my_view/nb_items" />
    </div>

    <script charset="UTF-8"
            tal:content="structure string:var NB_LISTED_ELEMENTS = ${my_view/nb_display_items}"></script>

    <table summary="Liste des fichiers">
    <thead>
        <tr>
            <th class="checkall show-for-medium-up">
                <div class="switch tiny round" title="Action par lot : tout sélectionner / désélectionner"
                     i18n:attributes="title">
                    <input type="checkbox" id="switch-all" name="checkall" role="paths:list" />
                    <label for="switch-all"></label>
                </div>
            </th>
            <th class="sort show-for-medium-up" data-sort="date" title="Trier selon la date"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Date</tal:block>
                </span>
            </th>
            <th class="sort" data-sort="filetype" title="Trier selon le type"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Type</tal:block>
                </span>
            </th>
            <th class="sort text-left" data-sort="title" title="Trier selon le titre"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Titre / Description</tal:block>
                </span>
            </th>
        </tr>
    </thead>
    <tbody class="list"
           tal:define="user_id user/getId">
        <tr tal:repeat="item my_view/course_add_list">
            <tal:define define="item_title python:here.getShortText(item['Title'])">
            <td class="show-for-medium-up"
                tal:define="attached python:context.test(item['getId'].replace('.', '*-*') in my_view['course_map'], 1, 0)">
                <div class="switch tiny round" title="Action par lot : sélectionner / désélectionner"
                     tal:condition="not:attached"
                     i18n:attributes="title">
                    <input type="checkbox" name="paths:list"
                           tal:attributes="id string:switch-${repeat/item/index};
                                           value string:${item/getId}/${item/Type};
                                           data-res_name item_title"/>
                    <label tal:attributes="for string:switch-${repeat/item/index}"></label>
                </div>
                <i class="fa fa-check fa-lg success" tal:condition="attached"></i>
            </td>
            <td class="date show-for-medium-up">
                <span class="hide" tal:content="python:context.getLocaleDate(item['ModificationDate'], '%Y%m%d%H%M%S')"/>
                <span tal:content="python:context.getLocaleDate(item['ModificationDate'])"/>
            </td>
            <td class="filetype">
                <i tal:attributes="class python:'fa fa-2x %s' % (context.get_type_fichier_script(item['getIcon']))"></i>
            </td>
            <td class="title">
                <span class="hide" tal:content="item/Title" />
                <strong tal:content="item_title"
                        i18n:attributes="title"/>
                <span class="show-for-medium-up"
                      tal:condition="item/Description"
                      tal:content="python:here.getShortText(item['Description'], 200)"/>
            </td>
            </tal:define>
        </tr>
    </tbody>
    </table>

    <tal:define define="script1 string:setBatchSelect('js-attachmentCreator');
                        script2 string:setSortableList('js-list-ressource',['date','filetype','title'],'date','desc')">
        <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script1)" />
        <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script2)" />
    </tal:define>

    <script charset="UTF-8"
            tal:define="buffer python:jsBuffer.getDirectBuffer()"
            tal:content="structure buffer"></script>
    </tal:listing>

</metal:macro>

<metal:macro define-macro="add_new_resource">

    <tal:define define="errors options/state/getErrors | nothing;">

    <h2>
        <i class="fa fa-plus-circle"></i>
        <tal:block i18n:translate="">Ajouter un fichier au cours et dans "Mes ressources > Fichiers"</tal:block>
    </h2>

    <form id="js-directExtFileCreator" method="POST" enctype="multipart/form-data"
          tal:attributes="action string:${my_view/course_link}/add_course_file_script;
                          data-success_msg string:Le fichier a été créé et ajouté au cours.">

        <div id="archetypes-fieldname-title" class="field"
            tal:define="error errors/title | nothing">
            <label for="title" class="formQuestion" i18n:translate="">Titre</label>
            <input type="text" id="title" name="title" value=""
                   maxlength="255" size="30"/>
        </div>

        <div id="archetypes-fieldname-description" class="field">
            <label for="description" i18n:translate="">Description</label>
            <textarea name="description" rows="5"></textarea>
        </div>

        <div id="archetypes-fieldname-file"
            tal:define="error errors/file_file | nothing;"
            tal:attributes="class python:context.test(error, 'field error', 'field')">
            <label for="file" i18n:translate="">Fichier</label>
            <div class="fieldErrorBox" tal:condition="error" tal:content="error"/>
            <input id="file_file" name="file_file" type="file" size="30"
                   required="required"/>
        </div>

        <tal:condition condition="my_view/is_course">
        <tal:replace replace="structure my_view/course_map_form"/>
        </tal:condition>

        <div class="field"
             tal:condition="my_view/is_display_hide">
            <h3><i class="fa fa-eye"></i><tal:block i18n:translate="">Disponibilité</tal:block></h3>
            <tal:define define="attacher_afficher request/attacher_afficher | string:0;">
            <input type="radio" name="display_item" id="attacher_afficher_new"
                   value="1"
                   tal:attributes="checked python:context.test(int(attacher_afficher), 'checked', '')" />
            <label for="attacher_afficher_new" i18n:translate="">Afficher immédiatement</label>
            <input type="radio" name="display_item" id="attacher_masquer_new"
                   value="0"
                   tal:attributes="checked python:context.test(int(attacher_afficher), '', 'checked')" />
            <label for="attacher_masquer_new" i18n:translate="">Masquer</label>
            </tal:define>
        </div>

        <input type="hidden" name="form.submitted" value="1" />
        <input type="hidden" name="user_id" tal:attributes="value user/getId" />
        <input type="hidden" name="folder_id" tal:attributes="value my_view/folder_id"/>
        <input type="hidden" name="validate_key" value="create_file" />

        <div class="formControls">
            <button type="submit" class="button small create radius">
                <i class="fa fa-plus-circle"></i>
                <tal:block i18n:translate="">Ajouter</tal:block>
            </button>
        </div>

    </form>

    <tal:comment replace="nothing">
    <script charset="UTF-8"
            tal:content="structure string:setRevealFormPlanRefresh('js-directExtFileCreator')"></script>
    </tal:comment>
    </tal:define>
</metal:macro>
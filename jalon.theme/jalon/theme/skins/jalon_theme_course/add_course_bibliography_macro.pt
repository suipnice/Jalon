<metal:macro define-macro="add_course_items">

    <tal:no_items condition="my_view/is_no_items">
        <div class="panel callout radius">
            <strong i18n:translate="">Il n'y a aucune ressource de type « Ressource externe » dans votre espace.</strong><br />
            <tal:block i18n:translate="">Rendez-vous dans votre espace de ressources externes pour en ajouter.</tal:block>
        </div>
        <div class="text-center">
            <a class="button radius"
               tal:attributes="href my_view/folder_link">
               <i tal:attributes="class my_view/course_add_list_icon"></i><tal:replace replace="context/Title" i18n:translate=""/>
            </a>
        </div>
    </tal:no_items>

    <tal:block condition="not:my_view/is_no_items">
        <div class="panel callout radius"
             tal:condition="not:my_view/course_add_list"
             i18n:translate="">
            Il n'y a aucune ressource avec cette association d'étiquettes.
        </div>
    </tal:block>

    <tal:listing condition="my_view/course_add_list">

    <div class="el_counter">
        <tal:block replace="my_view/nb_display_items"/>
        <tal:block i18n:translate="">sur</tal:block>
        <tal:block replace="my_view/nb_items"/>
    </div>

    <script charset="UTF-8"
            tal:content="structure string:var NB_LISTED_ELEMENTS = ${my_view/nb_display_items}"></script>

    <table summary="Liste des ressources externes">
    <thead>
        <tr>
            <th class="checkall show-for-medium-up">
                <div class="switch tiny round" title="Action par lot : tout sélectionner / désélectionner"
                     i18n:attributes="title">
                    <input type="checkbox" id="switch-all" name="checkall" role="paths:list"/>
                    <label for="switch-all"></label>
                </div>
            </th>
            <th class="sort show-for-medium-up" data-sort="date" title="Trier selon la date"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Date</tal:block>
                </span>
            </th>
            <th class="sort" data-sort="type" title="Trier selon le type"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Type</tal:block>
                </span>
            </th>
            <th class="sort text-left" data-sort="title" title="Trier selon le titre"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Titre / Description</tal:block>
                </span>
            </th>
        </tr>
    </thead>
    <tbody class="list"
           tal:define="user_id user/getId">
        <tr tal:repeat="item my_view/course_add_list">
            <tal:define define="item_title python:here.getShortText(item['Title'])">
            <td class="show-for-medium-up"
                tal:define="attached python:context.test(item['getId'].replace('.', '*-*') in my_view['course_map'], 1, 0)">
                <div class="switch tiny round" title="Action par lot : sélectionner / désélectionner"
                     tal:condition="not:attached"
                     i18n:attributes="title">
                    <input type="checkbox" name="paths:list"
                           tal:attributes="id string:switch-${repeat/item/index};
                                           value string:${item/getId}/${item/getTypeRessourceExterne};
                                           data-res_name item_title"/>
                    <label tal:attributes="for string:switch-${repeat/item/index}"></label>
                </div>
                <i class="fa fa-check fa-lg success" tal:condition="attached"></i>
            </td>
            <td class="date show-for-medium-up">
                <span class="hide" tal:content="python:context.getLocaleDate(item['ModificationDate'], '%Y%m%d%H%M%S')"/>
                <span tal:content="python:context.getLocaleDate(item['ModificationDate'])"/>
            </td>
            <td class="type">
                <span class="label bkgrnd" tal:content="item/getTypeRessourceExterne"/>
            </td>
            <td class="title">
                <span class="hide" tal:content="item/Title"/>
                <strong tal:content="item_title"
                        i18n:attributes="title"/>
                <span class="show-for-medium-up"
                      tal:condition="item/Description"
                      tal:content="python:here.getShortText(item['Description'], 160)"/>
            </td>
            </tal:define>
        </tr>
    </tbody>
    </table>

    <input type="hidden" name="glossary_or_bibliography" value="bibliography"/>

    <tal:define define="script1 string:setBatchSelect('js-attachmentCreator');
                        script2 string:setSortableList('js-list-ressource',['date','type','title'],'date','desc')">
        <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script1)"/>
        <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script2)"/>
    </tal:define>

    <script charset="UTF-8"
            tal:define="buffer python:jsBuffer.getDirectBuffer()"
            tal:content="structure buffer"></script>
    </tal:listing>

</metal:macro>

<metal:macro define-macro="add_new_resource">
<tal:define define="errors options/state/getErrors | nothing;">
    <h2>
        <i class="fa fa-plus-circle no-pad"></i>
        <tal:block i18n:translate="">Ajouter une ressource externe à la bibliographie du cours et dans "Mes ressources > Ressources externes"</tal:block>
    </h2>

    <form id="js-directExtResCreator" method="POST"
          tal:attributes="action string:${my_view/course_link}/add_course_external_resource_script;
                          data-success_msg string:La ressource externe a été créée et ajoutée au cours.">

        <div id="title"
             tal:define="error errors/title | nothing;"
             tal:attributes="class python:context.test(error, 'field error', 'field')">
            <label for="title" class="formQuestion" i18n:translate="label_title">
                Titre
            </label>
            <div class="fieldErrorBox" tal:condition="error" tal:content="error" />
            <input id="title" name="title" type="text" maxlength="255" size="30" placeholder="Saisie obligatoire"
                   tal:attributes="value request/title | nothing"
                   required="required"
                   i18n:attributes="placeholder" />
        </div>

        <div id="archetypes-fieldname-description" class="field">
            <label for="description" class="formQuestion" i18n:translate="label_description">
                Description
            </label>
            <textarea id="description" cols="40" name="description" rows="5"></textarea>
            <input type="hidden" value="text/plain" name="description_text_format" />
        </div>

        <div id="archetypes-fieldname-lien"
             tal:define="error errors/lien | nothing;"
             tal:attributes="class python:context.test(error, 'field error', 'field')">
            <label for="lien" class="formQuestion" i18n:translate="label_lecteur_exportable">
                URL ou Lecteur exportable
            </label>
            <div class="fieldErrorBox" tal:condition="error" tal:content="error" />
            <textarea id="lien" cols="40" name="lien" rows="5" placeholder="Saisie obligatoire"
                      required="required"
                      i18n:attributes="placeholder"><tal:replace replace="requet/lien | nothing" /></textarea>
        </div>

        <input type="hidden" name="user_id" tal:attributes="value user/getId" />
        <input type="hidden" name="folder_id" tal:attributes="value my_view/folder_id"/>
        <input type="hidden" name="biblio" value="true"/>

        <div class="formControls">
            <button type="submit" class="button small create radius">
                <i class="fa fa-plus-circle"></i>
                <tal:block i18n:translate="">Ajouter</tal:block>
            </button>
        </div>

    </form>

    <tal:comment replace="nothing">
        <script charset="UTF-8"
            tal:content="structure string:setRevealFormPlanRefresh('js-directExtResCreator')" />
    </tal:comment>
    </tal:define>
</metal:macro>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="jalon.content">

<body>


<metal:main fill-slot="content"
            tal:define="listeAcces context/getPublicsAnnonce">

    <h2>
        <tal:block i18n:translate="">Modifier une annonce</tal:block>
        <a class="close-reveal-modal"></a>
    </h2>

    <form id="js-mod-annonce" method="POST"
          tal:attributes="action string:${context/absolute_url}/${template/id}">

        <div tal:define="error errors/title | nothing;"
             tal:attributes="class python:context.test(error, 'field error', 'field')">
            <label for="title" i18n:translate="">Titre :</label>
            <div class="fieldErrorBox" tal:condition="error" tal:content="error" />
            <input type="text" id="title" name="title" required="required" placeholder="Saisie obligatoire"
                   tal:attributes="value context/title | nothing"
                   i18n:attributes="placeholder" />
        </div>

        <div tal:define="error errors/description | nothing;"
             tal:attributes="class python:context.test(error, 'field error', 'field')">
            <label for="description" i18n:translate="">Texte :</label>
            <div class="fieldErrorBox" tal:condition="error" tal:content="error" />
            <textarea id="description" name="description" rows="4"
                      required="required" placeholder="Saisie obligatoire"
                      tal:content="context/Description | nothing"
                      i18n:attributes="placeholder" />
        </div>

        <div class="field">
            <label i18n:translate="">Annonce visible par :</label>
            <div class="panel callout radius" i18n:translate="">
                Vous pouvez définir l'audience souhaitée pour cette annonce grâce à la colonne de gauche du tableau ci-dessous.
            </div>
            <table summary="Liste des filières attachées au cours"
                   i18n:attributes="summary">
            <thead>
                <tr>
                    <th class="checkall nosort">
                        <div class="switch tiny round" title="Tout sélectionner / désélectionner"
                             i18n:attributes="title">
                            <input type="checkbox" id="switch-all" name="checkall" role="publicsElement:list" />
                            <label for="switch-all"></label>
                        </div>
                    </th>
                    <th class="sort text-left" data-sort="title" title="Trier selon le type de public"
                        i18n:attributes="title">
                        <span>
                            <i class="fa fa-sort"></i>
                            <i class="fa fa-sort-asc"></i>
                            <i class="fa fa-sort-desc"></i>
                            <tal:block i18n:translate="">Public cible</tal:block>
                        </span>
                    </th>
                    <th class="sort" data-sort="rank" title="Trier selon le classement"
                        i18n:attributes="title">
                        <span>
                            <i class="fa fa-sort"></i>
                            <i class="fa fa-sort-asc"></i>
                            <i class="fa fa-sort-desc"></i>
                            <tal:block i18n:translate="">Classement</tal:block>
                        </span>
                    </th>
                    <th class="sort" data-sort="code" title="Trier selon le code"
                        i18n:attributes="title">
                        <span>
                            <i class="fa fa-sort"></i>
                            <i class="fa fa-sort-asc"></i>
                            <i class="fa fa-sort-desc"></i>
                            <tal:block i18n:translate="">Code</tal:block>
                        </span>
                    </th>
                    <th class="sort show-for-medium-up" data-sort="number" title="Trier selon l'effectif"
                        i18n:attributes="title">
                        <span>
                            <i class="fa fa-sort"></i>
                            <i class="fa fa-sort-asc"></i>
                            <i class="fa fa-sort-desc"></i>
                            <tal:block i18n:translate="">Eff.</tal:block>
                        </span>
                    </th>
                </tr>
            </thead>
            <tbody class="list"
                   tal:define="publics context/getPublics | python:[]">
                <tr tal:repeat="acces listeAcces">
                    <td>
                        <div class="switch tiny round" title="Sélectionner / désélectionner"
                             i18n:attributes="title">
                            <input type="checkbox" name="publicsElement:list"
                                   tal:define="valeur python:'%s*-*%s' % (acces[-1], acces[1])"
                                   tal:attributes="id string:switch-${repeat/acces/index};
                                                   value valeur;
                                                   checked python:context.test(valeur in publics, 1, 0)" />
                            <label tal:attributes="for string:switch-${repeat/acces/index}"></label>
                        </div>
                    </td>
                    <td class="title" tal:content="python:acces[0]" />
                    <td class="rank">
                        <span class="label tiny bkgrnd" tal:content="python:acces[-1]" />
                    </td>
                    <tal:define define="code python:context.test(acces[-1] != 'groupe', [acces[1], acces[2]], [acces[3], acces[2]])">
                    <td class="code" tal:content="python:code[0]" />
                    <td class="number" tal:content="python:code[1]" />
                    </tal:define>
                </tr>
            </tbody>
            </table>
        </div>

        <div class="panel callout radius" i18n:translate="">
            <tal:block i18n:translate="">Si vous avez défini une audience et ne souhaitez pas lui envoyer cette annonce par courriel, décochez la case ci-dessous.</tal:block>
            <div class="panel bkgrnd radius text-center">
                <input type="checkbox" id="mailAnnounce" name="mailAnnonce" checked="checked" />
                <label for="mailAnnounce" i18n:translate="">Envoyer également cette annonce par courriel.</label>
            </div>
        </div>

        <tal:block define="script1 string:setSortableList('js-mod-annonce',['title','rank','code','number'],'title','asc');
                           script2 string:setBatchSelect('js-mod-annonce',true)">
            <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script1)" />
            <tal:jsBuffer define="addDirectJsContent python:jsBuffer.addJSDirect(script2)" />
        </tal:block>

        <script charset="UTF-8"
                tal:define="buffer python:jsBuffer.getDirectBuffer()"
                tal:content="structure buffer"></script>

        <input type="hidden" name="form.submitted" value="1" />
        <input type="hidden" name="validate_key" value="edit_course_announce" />

        <div class="formControls">
            <button type="submit" class="button small radius">
                <i class="fa fa-pencil"></i>
                <tal:block i18n:translate="">Enregistrer</tal:block>
            </button>
        </div>

    </form>

</metal:main>

</body>

</html>
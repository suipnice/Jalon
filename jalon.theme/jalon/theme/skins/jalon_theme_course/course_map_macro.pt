<metal:macro define-macro="course_map_chapter_form">

    <div class="panel bkgrnd radius">
        <nav id="has_sticky_content">
            <form id="course-chapter_form" method="post"
                  tal:attributes="action context/absolute_url">
                <select name="course_title"
                        tal:define="course_map_title_list context/getCourseMapFirstTitle">
                    <option value="all">
                        <tal:block i18n:translate="">Cours</tal:block> « <tal:block tal:content="python:context.supprimerMarquageHTML(context.Title())" /> »
                    </option>
                    <optgroup tal:condition="course_map_title_list"
                              label="contenant les titres :"
                              i18n:attributes="label">
                        <tal:repeat repeat="course_map_title course_map_title_list">
                        <option tal:attributes="value course_map_title/title_id;
                                                selected python:context.test(course_map_id == course_map_title['title_id'], 'selected', '')">
                            <tal:block tal:content="course_map_title/title_text" />
                        </option>
                        </tal:repeat>
                    </optgroup>
                </select>
                <input type="hidden" name="mode_etudiant"
                       tal:attributes="value my_view/mode_etudiant"/>
            </form>
        </nav>
        <tal:block define="script1 string:setPlanChapterSelection();
                           script2 string:setStickyItem()">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script1)" />
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script2)" />
        </tal:block>
    </div>

</metal:macro>


<metal:macro define-macro="course_map_legend_bar">

    <ul tal:attributes="class python:context.test(my_view['has_course_map'], 'button-group radius even-3 legend_bar', 'button-group radius even-3 legend_bar hide')">
        <li>
            <a class="button tiny disabled" href="#">
                <i class="fa fa-arrow-circle-down"></i><tal:block i18n:translate="">Tout déplier</tal:block>
            </a>
        </li>
        <li>
            <a class="button tiny"
               data-reveal-id="reveal-main-large" data-reveal-ajax="true"
               tal:attributes="href string:${context/absolute_url}/display_map_legend_page?mode_etudiant=${mode_etudiant}">
                <i class="fa fa-info-circle"></i>
                <tal:block i18n:translate="legende">Afficher la légende</tal:block>
            </a>
        </li>
        <li>
            <a class="button tiny" href="#">
                <i class="fa fa-arrow-circle-right"></i><tal:block i18n:translate="">Tout replier</tal:block>
            </a>
        </li>
    </ul>

</metal:macro>


<metal:macro define-macro="course_map_item_adder">

    <div class="panel bkgrnd radius show-for-medium-up">
        <h3 class="show-for-medium-up">
            <i class="fa fa-plus-circle"></i>
            <tal:block i18n:translate="">Ajouter des éléments</tal:block>
        </h3>
        <nav id="has_sticky_content">
            <ul class="button-group even-3 radius course-item_adder">
                <li tal:repeat="item_adder my_view/course_map_item_adder">
                    <a tal:attributes="class item_adder/menu_adder_class;
                                       data-dropdown item_adder/menu_adder_data-dropdown"
                                       data-options="align:bottom">
                        <i tal:attributes="class item_adder/menu_adder_icon"></i>
                        <tal:replace replace="item_adder/menu_adder_name" i18n:translate=""/>
                    </a>
                    <ul tal:attributes="id item_adder/menu_adder_data-dropdown"
                        class="f-dropdown" data-dropdown-content>
                        <li tal:repeat="menu_adder_item item_adder/menu_adder_items">
                            <a tal:attributes="href menu_adder_item/item_link"
                               data-reveal-id="reveal-main-large" data-reveal-ajax="true">
                                <i tal:attributes="class menu_adder_item/item_icon"></i>
                                <tal:replace replace="menu_adder_item/item_name" i18n:translate=""/>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
        <tal:block define="script string:setStickyItem()">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
        </tal:block>
    </div>

</metal:macro>


<metal:macro define-macro="display_course_map">
        <li class="legend element"
            tal:condition="my_view/is_personnel">
            <i class="fa fa-info-circle fa-fw"></i>
            <tal:block i18n:translate="">Faites glisser des éléments existants du plan sur le titre, ou ajoutez de nouveaux éléments.</tal:block>
        </li>
    <tal:repeat repeat="element course_map/course_map_items_list">
        <li tal:attributes="id element/item_css_id;
                            class element/item_css_class">
            <div tal:attributes="class element/item_div_css">
                <tal:condition condition="my_view/is_personnel">
                <a class="dropdown" data-options="align:left"
                   tal:attributes="data-dropdown string:${element/item_drop_id}">
                    <i class="fa fa-cog fa-fw no-pad"></i>
                </a>
                <ul class="f-dropdown" data-dropdown-content="data-dropdown-content"
                    tal:attributes="id string:${element/item_drop_id}">
                    <li tal:repeat="item_action element/item_actions">
                        <a data-reveal-ajax="true" data-reveal-id="reveal-main"
                           tal:attributes="href string:${course_link}/${item_action/item_action_id}?item_id=${element/item_id}">
                            <i tal:attributes="class item_action/item_action_icon"></i>
                            <tal:replace tal:replace="item_action/item_action_name" i18n:translate=""/>
                        </a>
                    </li>
                </ul>
                </tal:condition>
                <i class='fa fa-bell-o fa-fw fa-lg no-pad right'
                   tal:condition="element/is_item_new"></i>

                <a class="right"
                   tal:attributes="href element/item_read_link"
                   tal:condition="element/is_item_readable">
                    <i tal:attributes="class element/item_read_icon"></i>
                </a>

                <i tal:attributes="class element/is_display_item_icon;
                                   title element/is_display_item_text"
                   tal:condition="not:element/is_display_item_bool"></i>

                <i class="fa fa-hand-o-left fa-lg fa-fw no-pad jalonner right" data-tooltip
                   tal:attributes="title element/item_jalonner_comment"
                   tal:condition="element/is_item_jalonner"></i>

                <span tal:attributes="class element/item_span_css">
                    <i title="Cliquer pour replier/déplier le contenu." class="fa no-pad js-fold"
                       tal:condition="element/is_item_title"></i>
                    <a class="typeElementTitre"
                       title="Voir cet élément du plan"
                       data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:attributes="href element/item_link | nothing"
                       tal:omit-tag="element/is_item_title_or_text">
                        <tal:replace replace="structure element/item_title"/>
                        <tal:condition condition="element/item_video">
                        <div class="pod_element panel radius">
                            <img class="show-for-small-only"
                                 tal:attributes="src element/item_image"/>
                            <img class="show-for-medium-only"
                                 tal:attributes="src element/item_image"/>
                            <img class="show-for-large-up"
                                 tal:attributes="src element/item_image"/>
                            <tal:condition condition="element/item_description">
                            <p class="show-for-medium-only"
                               tal:content="python:here.getShortText(element['item_description'], 260)"/>
                            <p class="show-for-large-up"
                               tal:content="python:here.getShortText(element['item_description'], 520)"/>
                            </tal:condition>
                            <tal:condition condition="not:element/item_description">
                            <p class="show-for-medium-up" i18n:translate="">
                                <em>Ce contenu UNSpod n'a pas de description.</em>
                            </p>
                            </tal:condition>
                        </div>
                        </tal:condition>
                    </a>
                </span>
            </div>
            <tal:condition condition="not:my_view/is_sub_course_map">
                <ol tal:condition="element/is_item_title">
                    <li class="element">
                        <a tal:attributes="href string:${context/absolute_url}?course_map_id=${element/item_id}&amp;mode_etudiant=true"
                           title="Voir le contenu de ce titre"
                           i18n:translate="">
                            Voir le contenu de ce titre.
                        </a>
                    </li>
                </ol>
            </tal:condition>
            <tal:condition condition="my_view/is_sub_course_map">
            <tal:condition condition="element/is_item_title">
            <tal:define define="course_map python:context.getCourseMapItems(element['course_map_sub_items_list'], user.getId(), my_view['user_last_login_time'], my_view['is_personnel'], my_view['course_news']['listeActu'], my_view['item_jalonner'], my_view['portal']);">
            <ol>
            <metal:macro use-macro="context/course_map_macro/macros/display_course_map">
                Affichage du plan du cours
            </metal:macro>
            </ol>
            </tal:define>
            </tal:condition>
            </tal:condition>
        </li>
    </tal:repeat>
</metal:macro>
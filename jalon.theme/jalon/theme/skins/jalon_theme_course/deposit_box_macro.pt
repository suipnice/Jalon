<!--
        Liste des dépots
-->
<metal:macro define-macro="deposit-list">

<tal:define define="dico_depots python:context.getDepots(user, my_view['is_personnel'], my_view['is_authorized_deposit'], my_view['is_late']);
                    liste_depots dico_depots/liste_depots">

    <tal:condition condition="my_view/is_personnel">
    <a class="dropdown right"
       data-options="align:left" data-dropdown="drop-action-depots">
        <i class="fa fa-cog fa-fw fa-lg no-pad"></i>
    </a>
    <ul class="f-dropdown" data-dropdown-content="data-dropdown-content"
        id="drop-action-depots">
        <li tal:repeat="menu dico_depots/menus">
            <a tal:attributes="href menu/href">
                <i tal:attributes="class string:fa ${menu/icon} fa-fw"></i><tal:block replace="menu/text"
                                                                                      i18n:translate=""/>
            </a>
        </li>
    </ul>
    </tal:condition>
    <a tal:attributes="href string:${context/absolute_url}/deposit_file_form"
       title="Déposer un fichier" class="button small radius right"
       data-reveal-id="reveal-main" data-reveal-ajax="true"
       tal:condition="python:not my_view['is_personnel'] and my_view['is_authorized_deposit']"
       i18n:translate="">
        <i class="fa fa-download"></i>
        <tal:block i18n:translate="">Déposer un fichier</tal:block>
    </a>
    <h2>
        <i class="fa fa-download"></i><tal:block replace="dico_depots/table_title"
                                                 i18n:translate=""/>
    </h2>

    <div tal:attributes="class string:panel ${my_view/class_limit_date} radius"
         tal:on-error="nothing">
        <i class="fa fa-info-circle"></i><strong>Attention :</strong>
        <span tal:content="structure my_view/is_authorized_deposit_text"/>
    </div>

    <div tal:define="infos_depots dico_depots/infos_depots"
         tal:attributes="class string:panel ${infos_depots/css_class} radius"
         tal:content="structure infos_depots/text"
         tal:condition="dico_depots/is_infos_depots"/>

    <div class="panel callout radius"
         tal:condition="not:liste_depots"
         i18n:translate="">
        Aucun dépôt
    </div>

    <table id="js-listeDepots"
           summary="Liste des dépots"
           tal:define="infos_tableau python:context.getInfosTableau(my_view['is_personnel'], my_view['is_authorized_deposit'])"
           tal:condition="liste_depots">

        <thead tal:define="head_table infos_tableau/head_table">
            <tr>
                <th tal:repeat="tr head_table"
                    tal:attributes="class tr/css_class;
                                    title tr/attr_title;
                                    data-sort tr/data-sort"
                    data-tooltip>
                    <span tal:condition="tr/data-sort">
                        <i class="fa fa-sort"></i>
                        <i class="fa fa-sort-asc"></i>
                        <i class="fa fa-sort-desc"></i>
                        <tal:block content="tr/column_title" i18n:translate=""/>
                    </span>
                    <tal:block replace="structure tr/column_title"
                               condition="not:tr/data-sort"/>
                </th>
            </tr>
        </thead>
        <tbody class="list">
        <tal:block repeat="depot liste_depots">
            <tr>
                <td class="name"
                    tal:condition="infos_tableau/is_column_etudiant"
                    tal:content="depot/etudiant_name" />
                <td class="title">
                    <span class="hide" tal:content="depot/date_sort" />
                    <i tal:condition="depot/is_corrupt"
                       class="fa fa-exclamation-triangle right has-tip" data-tooltip
                       title="Attention ! Ce dépôt est peut être corrompu, merci de vérifier en le téléchargeant."
                       i18n:attributes="title">
                    </i>
                    <a tal:attributes="href string:${context/absolute_url}/cours_element_view?idElement=${depot/depot_id}&amp;typeElement=JalonFile&amp;createurElement=${user/getId}&amp;indexElement=0"
                       data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:content="depot/depot_title" />
                    <span tal:content="depot/date_aff" />
                </td>
                <tal:repeat repeat="column depot/columns_etat_correction_notation">
                <td tal:attributes="class column/css_class"
                    tal:condition="python:infos_tableau[column['test']]">
                    <span tal:attributes="class column/span_css_class"
                          tal:content="column/text"
                          i18n:translate="" />
                </td>
                </tal:repeat>
                <td tal:condition="infos_tableau/is_column_actions"
                    tal:define="depot_action depot/depot_action">
                    <a tal:attributes="title depot_action/action_title;
                                       href depot_action/action_url"
                       data-reveal-id="reveal-main" data-reveal-ajax="true"
                       i18n:attributes="title">
                        <i tal:attributes="class string:fa ${depot_action/action_icon} fa-2x fa-fw"></i>
                    </a>
                </td>
            </tr>
        </tal:block>
        </tbody>
    </table>

    <tal:define define="acces_depots dico_depots/acces_depots">
        <tal:block condition="python:my_view['is_personnel'] or acces_depots"
                   define="script string:setSortableList('js-listeDepots',['name','title','valide','correction','note'],'name','desc')">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
        </tal:block>
        <tal:block condition="python:not my_view['is_personnel'] and not acces_depots"
                   define="script string:setSortableList('js-listeDepots',['title','valide','correction','note'],'title','desc')">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
        </tal:block>
    </tal:define>

</tal:define>
</metal:macro>

<!--
    Évaluation par les pairs
-->
<metal:macro define-macro="peers-list">
    <tal:define define="evaluation_by_peers_dict python:context.getEvaluationByPeers(user, my_view['is_personnel']);
                        criteria_dict evaluation_by_peers_dict/criteria_dict">
    <tal:condition condition="my_view/is_personnel">
    <a class="right"
       tal:attributes="href string:${my_view/deposit_box_link}/deposit_box_criteria_view">
        <i tal:attributes="class evaluation_by_peers_dict/gride_button"></i>
    </a>
    <!--a class="dropdown right"
       data-options="align:left" data-dropdown="drop-action-peers">
        <i class="fa fa-cog fa-fw fa-lg no-pad"></i>
    </a>
    <ul class="f-dropdown" data-dropdown-content="data-dropdown-content"
        id="drop-action-peers">
        <li tal:repeat="option evaluation_by_peers_dict/options">
            <a tal:attributes="href option/link"
               data-reveal-id="reveal-main" data-reveal-ajax="true">
                <i tal:attributes="class string:fa ${option/icon} fa-fw"></i><tal:block replace="option/text"
                                                                                      i18n:translate=""/>
            </a>
        </li>
    </ul-->
    </tal:condition>
    <h2>
        <tal:on-error on-error="nothing">
        <a tal:attributes="href evaluation_by_peers_dict/grid_link" class="button tiny radius right">
            <i class="fa fa-th" aria-hidden="true"></i>
            Grille d'évaluation
        </a>
        </tal:on-error>
        <a tal:attributes="href evaluation_by_peers_dict/evaluate_link" class="button tiny radius right"
           tal:condition="not:my_view/is_personnel">
            <i class="fa fa-check-square-o" aria-hidden="true"></i>
            Évaluer
        </a>
        <i class="fa fa-users"></i><tal:block replace="evaluation_by_peers_dict/table_title"
                                                 i18n:translate=""/>
    </h2>

    <div tal:attributes="class string:panel ${my_view/class_limit_date} radius"
         tal:on-error="nothing">
        <i class="fa fa-info-circle"></i><strong>Attention :</strong>
        <span tal:content="structure my_view/is_authorized_deposit_text"/>
    </div>

    <div class="panel callout radius" tal:condition="not:criteria_dict"
         i18n:translate="">
        La grille d'évaluation ne contient aucun critère.
    </div>

    <tal:condition condition="criteria_dict">
        <metal:macro use-macro="python:context.deposit_box_macro.macros.get(evaluation_by_peers_dict['macro_peers'])"/>
    </tal:condition>
    </tal:define>
</metal:macro>

<!--
    Évaluation par les pairs Liste role Personnel
-->
<metal:macro define-macro="peers_teacher_macro">
    <form id="js-list_competences" method="post"
          tal:attributes="action string:${my_view/deposit_box_link}/enregistrer_comp_script"
          tal:condition="my_view/is_personnel">
        <div class="table-overflow_container">
            <table summary="Liste des compétences">
            <thead>
                <tr>
                    <th class="sort has-tip" data-tooltip data-sort="etudiant"
                        title="Cliquer pour trier selon l'étudiant"
                        i18n:attributes="title">
                        <span>
                            <i class="fa fa-sort"></i>
                            <i class="fa fa-sort-asc"></i>
                            <i class="fa fa-sort-desc"></i>
                            <tal:block i18n:translate="">Nom de l'étudiant</tal:block>
                        </span>
                    </th>
                <tal:repeat repeat="index evaluation_by_peers_dict/criteria_order">
                    <th tal:define="criteria python:criteria_dict[index]">
                        <tal:replace tal:replace="criteria/title">Titre du critère</tal:replace>
                    </th>
                </tal:repeat>
                </tr>
            </thead>
            <tfoot></tfoot>
            <tbody class="list"
                   tal:define="peers_average_dict evaluation_by_peers_dict/peers_average_dict">
                <tr tal:condition="not:evaluation_by_peers_dict/peers_list">
                    <td tal:attributes="colspan python:(len(criteria_dict) + 1)">
                        <strong i18n:translate="">Aucun étudiant à évaluer</strong>
                    </td>
                </tr>
                <tal:condition condition="evaluation_by_peers_dict/peers_list">
                <tr tal:repeat="peer evaluation_by_peers_dict/peers_list">
                    <td class="etudiant">
                        <span class="hide" tal:content="peer/nom" />
                        <a tal:attributes="href string:${my_view/deposit_box_link}/deposit_box_evaluation_view?student_id=${peer/id}">
                            <tal:replace replace="peer/nom" />
                        </a>
                    </td>
                    <td tal:repeat="criteria evaluation_by_peers_dict/criteria_order">
                        <tal:condition condition="python:peer['id'] in peers_average_dict">
                        <tal:replace replace="python:peers_average_dict[peer['id']][int(criteria)]" on-error="nothing"/>
                        </tal:condition>
                        <tal:condition condition="python:peer['id'] not in peers_average_dict">
                            <a tal:attributes="href string:${my_view/deposit_box_link}/evaluate_deposit_file_form?student_id=${peer/id}">
                                <i class="fa fa-exclamation-triangle fa-2x alert"></i>
                            </a>
                        </tal:condition>
                    </td>
                </tr>
                </tal:condition>
            </tbody>
            </table>
        </div>
    </form>
</metal:macro>

<!--
    Évaluation par les pairs Liste role Étudiant
-->
<metal:macro define-macro="peers_student_macro">
    <div class="panel callout radius"
         tal:content="evaluation_by_peers_dict/peers_correction_indication"/>
    <div class="table-overflow_container"
         tal:condition="evaluation_by_peers_dict/peers_evaluations">
        <table summary="Liste des critères">
        <thead>
            <tr>
                <th class="sort has-tip" data-tooltip data-sort="criteria"
                    title="Cliquer pour trier selon l'étudiant"
                    i18n:attributes="title">
                    <span>
                        <i class="fa fa-sort"></i>
                        <i class="fa fa-sort-asc"></i>
                        <i class="fa fa-sort-desc"></i>
                        <tal:block i18n:translate="">Critères</tal:block>
                    </span>
                </th>
            <tal:repeat repeat="peer evaluation_by_peers_dict/peers_evaluations">
                <th>
                    Devoir n°<tal:replace tal:replace="repeat/peer/number"/>
                </th>
            </tal:repeat>
            </tr>
        </thead>
        <tfoot></tfoot>
        <tbody class="list"
               tal:define="compEtudiants python:dict(context.getCompEtudiants())">
            <tr tal:repeat="index evaluation_by_peers_dict/criteria_order">
                <td class="criteria"
                    tal:define="criteria python:criteria_dict[index]">
                    <span class="hide" tal:content="criteria/title" />
                    <tal:replace replace="criteria/title" />
                </td>
            <tal:repeat repeat="peer evaluation_by_peers_dict/peers_evaluations">
                <td>VIDE</td>
            </tal:repeat>
            </tr>
        </tbody>
        </table>
    </div>
</metal:macro>
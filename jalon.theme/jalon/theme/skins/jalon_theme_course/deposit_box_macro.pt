<!--
        Liste des dépots
-->
<metal:macro define-macro="deposit-list">

<tal:define define="dico_depots python:context.getDepots(user, my_view['is_personnel'], my_view['is_authorized_deposit'], my_view['is_late']);
                    liste_depots dico_depots/liste_depots">

    <tal:condition condition="my_view/is_personnel">
    <a class="dropdown right"
       data-options="align:left" data-dropdown="drop-action-depots">
        <i class="fa fa-cog fa-fw fa-lg no-pad"></i>
    </a>
    <ul class="f-dropdown" data-dropdown-content="data-dropdown-content"
        id="drop-action-depots">
        <li tal:repeat="menu dico_depots/menus">
            <a tal:attributes="href menu/href">
                <i tal:attributes="class string:fa ${menu/icon} fa-fw"></i><tal:block replace="menu/text"
                                                                                      i18n:translate=""/>
            </a>
        </li>
    </ul>
    </tal:condition>
    <tal:condition condition="not:my_view/is_personnel">
    <a tal:attributes="href string:${context/absolute_url}/deposit_file_form"
       title="Déposer un fichier" class="button small radius right"
       data-reveal-id="reveal-main" data-reveal-ajax="true"
       tal:condition="my_view/is_authorized_deposit"
       i18n:translate="">
        <i class="fa fa-download"></i>
        <tal:block i18n:translate="">Déposer un fichier</tal:block>
    </a>
    <tal:on-error on-error="nothing">
    <a tal:attributes="href my_view/grid_link" class="button small radius right">
        <i class="fa fa-th" aria-hidden="true"></i>
        Grille d'évaluation
    </a>
    </tal:on-error>
    </tal:condition>
    <h2>
        <i class="fa fa-download"></i><tal:block replace="dico_depots/table_title"
                                                 i18n:translate=""/>
    </h2>

    <div tal:attributes="class string:panel ${my_view/class_limit_date} radius"
         tal:on-error="nothing">
        <i class="fa fa-info-circle"></i><strong>Attention :</strong>
        <span tal:content="structure my_view/is_authorized_deposit_text"/>
    </div>

    <div tal:define="infos_depots dico_depots/infos_depots"
         tal:attributes="class string:panel ${infos_depots/css_class} radius"
         tal:content="structure infos_depots/text"
         tal:condition="dico_depots/is_infos_depots"/>

    <div class="panel callout radius"
         tal:condition="not:liste_depots"
         i18n:translate="">
        Aucun dépôt
    </div>

    <table id="js-listeDepots"
           summary="Liste des dépots"
           tal:define="infos_tableau python:context.getInfosTableau(my_view['is_personnel'], my_view['is_authorized_deposit'])"
           tal:condition="liste_depots">

        <thead tal:define="head_table infos_tableau/head_table">
            <tr>
                <th tal:repeat="tr head_table"
                    tal:attributes="class tr/css_class;
                                    title tr/attr_title;
                                    data-sort tr/data-sort"
                    data-tooltip>
                    <span tal:condition="tr/data-sort">
                        <i class="fa fa-sort"></i>
                        <i class="fa fa-sort-asc"></i>
                        <i class="fa fa-sort-desc"></i>
                        <tal:block content="tr/column_title" i18n:translate=""/>
                    </span>
                    <tal:block replace="structure tr/column_title"
                               condition="not:tr/data-sort"/>
                </th>
            </tr>
        </thead>
        <tbody class="list">
        <tal:block repeat="depot liste_depots">
            <tr>
                <td class="name"
                    tal:condition="infos_tableau/is_column_etudiant"
                    tal:content="depot/etudiant_name" />
                <td class="title">
                    <span class="hide" tal:content="depot/date_sort" />
                    <i tal:condition="depot/is_corrupt"
                       class="fa fa-exclamation-triangle right has-tip" data-tooltip
                       title="Attention ! Ce dépôt est peut être corrompu, merci de vérifier en le téléchargeant."
                       i18n:attributes="title">
                    </i>
                    <a tal:attributes="href depot/depot_url"
                       data-reveal-id="reveal-main" data-reveal-ajax="true"
                       tal:content="depot/depot_title" />
                    <span tal:content="depot/date_aff" />
                </td>
                <tal:repeat repeat="column depot/columns_etat_correction_notation">
                <td tal:attributes="class column/css_class"
                    tal:condition="python:infos_tableau[column['test']]">
                    <span tal:attributes="class column/span_css_class"
                          tal:content="column/text"
                          i18n:translate="" />
                </td>
                </tal:repeat>
                <td tal:condition="infos_tableau/is_column_actions"
                    tal:define="depot_action depot/depot_action">
                    <a tal:attributes="title depot_action/action_title;
                                       href depot_action/action_url"
                       data-reveal-id="reveal-main" data-reveal-ajax="true"
                       i18n:attributes="title">
                        <i tal:attributes="class string:fa ${depot_action/action_icon} fa-2x fa-fw"></i>
                    </a>
                </td>
            </tr>
        </tal:block>
        </tbody>
    </table>

    <tal:define define="acces_depots dico_depots/acces_depots">
        <tal:block condition="python:my_view['is_personnel'] or acces_depots"
                   define="script string:setSortableList('js-listeDepots',['name','title','valide','correction','note'],'name','desc')">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
        </tal:block>
        <tal:block condition="python:not my_view['is_personnel'] and not acces_depots"
                   define="script string:setSortableList('js-listeDepots',['title','valide','correction','note'],'title','desc')">
            <tal:jsBuffer define="addJsContent python:jsBuffer.addJS(script)" />
        </tal:block>
    </tal:define>

</tal:define>
</metal:macro>

<!--
    Évaluation par les pairs
-->
<metal:macro define-macro="peers-list">
    <tal:define define="evaluation_by_peers_dict python:context.getEvaluationByPeers(user, my_view['is_personnel']);
                        criteria_dict evaluation_by_peers_dict/criteria_dict">
    <a class="button expand radius"
       tal:attributes="href string:${my_view/deposit_box_link}/deposit_box_criteria_view"
       tal:condition="my_view/grid_access">
       <i class="fa fa-th"></i>Accèder à la grille d'évaluation
    </a>
    <tal:condition condition="my_view/accessSelfEvaluation">
        <h2><i class="fa fa-user"></i>Mon auto-évaluation</h2>
        <a class="button expand radius"
           tal:attributes="href my_view/self_evalution_link">
           <i tal:attributes="class my_view/self_evalution_button"></i><tal:replace replace="my_view/self_evalution_name"/>
        </a>
    </tal:condition>
    <tal:condition condition="my_view/accessEvaluation">
        <h2><i class="fa fa-th"></i>Mon évaluation</h2>
        <a class="button expand radius"
           tal:attributes="href string:${my_view/deposit_box_link}/deposit_box_evaluation_view">
           <i class="fa fa-trophy"></i>Consulter mon évaluation
        </a>
    </tal:condition>
    <tal:condition condition="my_view/is_personnel">
    <a class="dropdown right"
       data-options="align:left" data-dropdown="drop-action-peers">
        <i class="fa fa-cog fa-fw fa-lg no-pad"></i>
    </a>
    <ul class="f-dropdown" data-dropdown-content="data-dropdown-content"
        id="drop-action-peers">
        <li tal:repeat="option evaluation_by_peers_dict/options">
            <a tal:attributes="href option/link"
               data-reveal-id="reveal-main" data-reveal-ajax="true">
                <i tal:attributes="class string:fa ${option/icon} fa-fw"></i><tal:block replace="option/text"
                                                                                      i18n:translate=""/>
            </a>
        </li>
    </ul>
    </tal:condition>
    <h2>
        <i class="fa fa-users"></i><tal:block replace="evaluation_by_peers_dict/table_title"
                                                 i18n:translate=""/>
    </h2>

    <tal:on-error on-error="nothing">
    <div class="panel callout radius"
         tal:condition="not:evaluation_by_peers_dict/evaluate_button">
        Vous n'avez aucun dépôt à évaluer.
    </div>
    </tal:on-error>
    <div tal:attributes="class string:panel ${my_view/class_limit_date} radius"
         tal:on-error="nothing">
        <i class="fa fa-info-circle"></i><strong>Attention :</strong>
        <span tal:content="structure my_view/is_authorized_deposit_text"/>
    </div>

    <tal:condition condition="not:criteria_dict">
    <div class="panel callout radius" 
         i18n:translate="">
        La grille d'évaluation ne contient aucun critère.
    </div>
    </tal:condition>

    <tal:condition condition="criteria_dict">
        <metal:macro use-macro="python:context.deposit_box_macro.macros.get(evaluation_by_peers_dict['macro_peers'])"/>
    </tal:condition>
    </tal:define>
</metal:macro>

<!--
    Évaluation par les pairs Liste role Personnel
-->
<metal:macro define-macro="peers_teacher_macro">
    <form id="js-list_competences" method="post"
          tal:attributes="action string:${my_view/deposit_box_link}/enregistrer_comp_script"
          tal:condition="my_view/is_personnel">
        <div class="panel callout radius">
            <strong>Étudiants évalués :</strong>
            <tal:replace replace="evaluation_by_peers_dict/evaluations_notes"/>
            <br/>
            <strong>Évaluations correctes :</strong>
            <tal:replace replace="evaluation_by_peers_dict/evaluations_validate"/>
            <br/>
            <a class="button tiny radius right" tal:attributes="href string:${my_view/deposit_box_link}/deposit_box_details_evaluations_view">Consulter</a>
            <strong>Évaluations à vérifier :</strong>
            <tal:replace replace="evaluation_by_peers_dict/verif_evaluations_notes"/>
        </div>
        <h2><i class="fa fa-check-square-o" aria-hidden="true"></i>Notes sur 20</h2>
        <div class="panel callout radius">
            <strong>Note minimale :</strong>
            <tal:replace replace="evaluation_by_peers_dict/evaluations_notes_min"/>
            <br/>
            <strong>Note maximale :</strong>
            <tal:replace replace="evaluation_by_peers_dict/evaluations_notes_max"/>
            <br/>
            <strong>Moyenne :</strong>
            <tal:replace replace="evaluation_by_peers_dict/evaluations_notes_avg"/>
        </div>
        <h2><i class="fa fa-th"></i>Critères d'évaluation</h2>
        <tal:repeat repeat="index evaluation_by_peers_dict/criteria_order">
            <tal:define define="criteria python:criteria_dict[index];
                                has_notes python:index in evaluation_by_peers_dict['criteria_notes_dict']">
            <tal:condition condition="my_view/is_depot_actif">
            <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${my_view/deposit_box_link}/delete_deposit_box_criteria_form?criteria_id=${index}">
                <i class="fa fa-trash-o alert"></i>
            </a>
            <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${my_view/deposit_box_link}/edit_deposit_box_criteria_form?criteria_id=${index}">
                <i class="fa fa-pencil"></i>
            </a>
            </tal:condition>
            <tal:condition condition="not:my_view/is_correction_actif">
            <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${my_view/deposit_box_link}/undo_deposit_box_criteria_form?criteria_id=${index}">
                <i class="fa fa-undo warning"></i>
            </a>
            <a class="right" data-reveal-id="reveal-main" data-reveal-ajax="true"
               tal:attributes="href string:${my_view/deposit_box_link}/redo_deposit_box_criteria_form?criteria_id=${index}">
                <i class="fa fa-pencil"></i>
            </a>
            </tal:condition>
            <h3 tal:replace="criteria/title">Titre du critère</h3>
            <div class="panel callout radius"
                 tal:condition="not:has_notes">
                Aucune note n'est actuellement disponible pour ce critère.
            </div>
            <div class="row"
                 tal:condition="has_notes">
                <div class="small-12 medium-6 columns">
                    <div class="panel callout radius"
                         tal:define="criteria_notes python:evaluation_by_peers_dict['criteria_notes_dict'][index]">
                        <strong>Note minimale :</strong>
                        <tal:replace replace="criteria_notes/min"/>
                        <br/>
                        <strong>Note maximale :</strong>
                        <tal:replace replace="criteria_notes/max"/>
                        <br/>
                        <strong>Moyenne :</strong>
                        <tal:replace replace="criteria_notes/avg"/>
                    </div>
                </div>
                <div class="small-12 medium-6 columns">
                    <dl class="deflist">
                        <dt>Nombre de points</dt>
                        <dd tal:content="criteria/notation" />
                        <dt>Coefficient</dt>
                        <dd tal:content="criteria/coefficient" />
                    </dl>
                </div>
            </div>
            </tal:define>
        </tal:repeat>
    </form>
</metal:macro>

<!--
    Évaluation par les pairs Liste role Étudiant V1
-->
<metal:macro define-macro="peers_student_macro">
    <a tal:attributes="href evaluation_by_peers_dict/evaluate_link" class="button expand radius"
       tal:condition="evaluation_by_peers_dict/evaluate_button">
        <i class="fa fa-check-square-o" aria-hidden="true"></i>
        <tal:replace replace="evaluation_by_peers_dict/evaluate_button_name"/>
    </a>
    <!--div class="panel callout radius">
        Vous avez évalué tous les dépôts.
    </div-->
    <h2 tal:condition="evaluation_by_peers_dict/corrected_evaluation_list">
        <i class="fa fa-check-square-o"></i>
        Dépôt(s) évalué(s)
    </h2>
    <div class="panel callout radius"
         tal:content="evaluation_by_peers_dict/peers_correction_indication"/>
    <table summary="Liste des dépôts évalués"
           tal:condition="evaluation_by_peers_dict/corrected_evaluation_list">
    <thead>
        <tr>
            <th class="sort has-tip" data-tooltip data-sort="depot"
                title="Cliquer pour trier selon le dépôt"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Dépôt</tal:block>
                </span>
            </th>
            <th class="sort has-tip" data-tooltip data-sort="note"
                title="Cliquer pour trier selon la note"
                i18n:attributes="title">
                <span>
                    <i class="fa fa-sort"></i>
                    <i class="fa fa-sort-asc"></i>
                    <i class="fa fa-sort-desc"></i>
                    <tal:block i18n:translate="">Note</tal:block>
                </span>
            </th>
            <th class="show-for-medium-up has-tip" title="Action"
                tal:condition="evaluation_by_peers_dict/is_evaluable"
                i18n:attributes="title">
                <tal:block i18n:translate="">Réévaluer</tal:block>
            </th>
        </tr>
    </thead>
    <tfoot></tfoot>
    <tbody class="list">
        <tr tal:repeat="number evaluation_by_peers_dict/corrected_evaluation_list">
            <td>
                Dépôts n°<tal:replace replace="number"/>
            </td>
            <td>
                <tal:replace replace="python:evaluation_by_peers_dict['evaluations_note_dict'][number]"/>
            </td>
            <td tal:condition="evaluation_by_peers_dict/is_evaluable">
                <a class="button small radius"
                   tal:attributes="href string:${evaluation_by_peers_dict/evaluate_link}&amp;deposit_id=${repeat/number/index}">
                    <i class="fa fa-check-square-o"></i>Réévaluer
                </a>
            </td>
        </tr>
    </tbody>
    </table>
</metal:macro>
<!--
    Évaluation par les pairs Liste role Étudiant V1
<metal:macro define-macro="peers_student_macro">
    <div class="panel callout radius"
         tal:content="evaluation_by_peers_dict/peers_correction_indication"/>
    <div class="table-overflow_container"
         tal:condition="evaluation_by_peers_dict/peers_evaluations">
        <table summary="Liste des critères">
        <thead>
            <tr>
                <th class="sort has-tip" data-tooltip data-sort="criteria"
                    title="Cliquer pour trier selon l'étudiant"
                    i18n:attributes="title">
                    <span>
                        <i class="fa fa-sort"></i>
                        <i class="fa fa-sort-asc"></i>
                        <i class="fa fa-sort-desc"></i>
                        <tal:block i18n:translate="">Critères</tal:block>
                    </span>
                </th>
            <tal:repeat repeat="peer evaluation_by_peers_dict/peers_evaluations">
                <th>
                    Devoir n°<tal:replace tal:replace="repeat/peer/number"/>
                </th>
            </tal:repeat>
            </tr>
        </thead>
        <tfoot></tfoot>
        <tbody class="list"
               tal:define="corrected_evaluations_dict evaluation_by_peers_dict/corrected_evaluations_dict">
            <tr tal:repeat="index evaluation_by_peers_dict/criteria_order">
                <tal:define define="crtieria_evaluations_dict python:corrected_evaluations_dict[index]">
                <td class="criteria"
                    tal:define="criteria python:criteria_dict[index]">
                    <span class="hide" tal:content="criteria/title" />
                    <tal:replace replace="criteria/title" />
                </td>
                <td tal:repeat="peer_dict evaluation_by_peers_dict/peers_evaluations">
                    <tal:replace replace="python:crtieria_evaluations_dict[peer_dict['peer']]"
                                 on-error="string:Non évalué"/>
                </td>
                </tal:define>
            </tr>
        </tbody>
        </table>
    </div>
</metal:macro>

-->
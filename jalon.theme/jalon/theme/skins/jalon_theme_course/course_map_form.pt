<div class="field">
    <label for="position">Positionner dans le plan</label>
    <select id="position" name="map_position">
        <option value="debut_racine">
            Au début du plan
        </option>
        <option value="fin_racine" selected="selected">
            À la fin du plan
        </option>
        <optgroup label="Dans :"
                  tal:define="course_map python:context.getPlan();
                              parent_id string:racine;
                              position python:0">
            <metal:macro define-macro="course_map_select">
            <tal:repeat repeat="element course_map">
                <tal:define define="position python:position + 1">
                <tal:condition condition="python:element['idElement'].startswith('Titre')">
                <option tal:attributes="value string:${parent_id}*-*${element/idElement}">
                    <tal:repeat repeat="tmp python:range(position - 1)">
                        &nbsp;&nbsp;
                    </tal:repeat>
                    <tal:replace replace="python:context.getPlainShortText(context.getCourseItemProperties(element['idElement'])['titreElement'])"/>
                    <tal:define define="course_map element/listeElement;
                                        parent_id string:${parent_id}*-*${element/idElement}">
                        <metal:macro use-macro="context/course_map_form/macros/course_map_select"/>
                    </tal:define>
                </option>
                </tal:condition>
                </tal:define>
            </tal:repeat>
            </metal:macro>
        </optgroup>
    </select>
</div>